#!/usr/bin/python env python
# -*- coding: utf-8 -*-


import os
import sys
import argparse
import subprocess

__version__ = "0.0.3"
__author__ = "dslackw"
__license__ = "GPLv3"

''' path file record '''
__packages__ = "/var/log/packages/"


# main function
def main():
	description = "Slpkg is a Slackware tool to upgrade, remove, find and view packages contents"
	parser = argparse.ArgumentParser(description=description)
        parser.add_argument("-v", "--verbose", help="print version and exit", action="store_true")
        parser.add_argument("-u", "--upgrade", help="install-upgrade package with new", type=str)
	parser.add_argument("-a", "--reinstall", help="reinstall the same package", type=str)
	parser.add_argument("-r", "--remove", help="remove package", type=str)
        parser.add_argument("-l", "--list", help="list of installed packages", action="store_true")
	parser.add_argument("-f", "--find", help="find if package installed", type=str)
	parser.add_argument("-d", "--display", help="display the contents of the package", type=str)
	args = parser.parse_args()

	# print version and exit
        if args.verbose:
                print ("Version: " + __version__)

	# upgrade package with new
        if args.upgrade:
		os.system("upgradepkg --install-new {}".format(args.upgrade))

	# upgrade package with the same
	if args.reinstall:
		os.system("upgradepkg --reinstall {}".format(args.reinstall))

	# uninstall package
	if args.remove:
		find_pkg = subprocess.check_output(["find " + __packages__ + " -name '{}*' 2> /dev/null".format(args.remove)],shell=True)
		if find_pkg == "":
                        os.system("echo -e '\e[31mThe package is not found\e[39m'")
		else:
			os.system("echo -e '\e[93m!!! WARNING !!!\e[39m'")
			remove_pkg = raw_input("Are you sure to remove this package [y/n] ")
			if remove_pkg == "y" or remove_pkg == "Y":
				os.system("removepkg {}".format(args.remove))

	# view list of installed packages
	if args.list:
		os.system("ls " + __packages__ + "* | more")

	# find if packages installed on your system
	if args.find:
		find_pkg = subprocess.check_output(["find " + __packages__ + " -name '{}*' 2> /dev/null".format(args.find)],shell=True)
		if find_pkg == "":		
			os.system("echo -e '\e[31mThe package is not installed on your system\e[39m'")
		else:
			os.system("echo -e '\e[32mThe package is installed on your system\e[39m'")
	
	# print the package contents
	if args.display:
		find_pkg = subprocess.check_output(["find " + __packages__ + " -name '{}*' 2> /dev/null".format(args.display)],shell=True)
		if find_pkg == "":
			os.system("echo -e '\e[31mThe package is not found\e[39m'")
		else:
			os.system("cat {}".format(find_pkg))


main() 
